import{u as w,s as b,d as N,b as k,r as g,j as s,a as _,g as h,I as x,B as G,L as P,G as L,h as C,y as U,z as D,D as E}from"./index-DWqrGaFz.js";import{P as S}from"./PageHero-CiA6V5Ip.js";import"./clouds-top-B3AemNNE.js";const q=()=>{const l=w(),j=b(),c=new URLSearchParams(j.search).get("redirect")||"/account",{login:d}=N(),{toast:r}=k(),[m,u]=g.useState(!1),[i,v]=g.useState({username:"",password:""}),p=n=>{const{id:e,value:a}=n.target;v(t=>({...t,[e]:a}))},f=async n=>{try{const e=C(n.credential);console.log("Google User:",e);const a={id:Date.now(),username:e.email.split("@")[0],email:e.email,first_name:e.given_name,last_name:e.family_name,billing:{first_name:e.given_name,last_name:e.family_name,email:e.email,address_1:"",city:"",postcode:"",country:"",phone:""},shipping:{first_name:e.given_name,last_name:e.family_name,address_1:"",city:"",postcode:"",country:""}};try{const t=await U(a);console.log("Synced WP User:",t),a.id=t.id,a.billing={...a.billing,...t.billing},a.shipping={...a.shipping,...t.shipping}}catch(t){console.error("Failed to sync Google User to WP:",t),r({title:"Greška sinkronizacije",description:"Nismo uspjeli povezati vaš račun sa serverom.",variant:"destructive"});return}d("google-session-token",a),r({title:"Uspješna Google prijava",description:`Dobrodošli, ${e.name}!`}),l(c)}catch(e){console.error("Google Login Error",e),r({title:"Greška",description:"Neuspješna prijava putem Google-a.",variant:"destructive"})}},y=async n=>{n.preventDefault(),u(!0);try{const e=await D(i.username,i.password);if(e&&e.id){let a=e;try{const o=await E(e.id);o&&(a={...e,...o})}catch(o){console.warn("Failed to fetch WC customer details, using basic WP user",o)}const t=btoa(unescape(encodeURIComponent(`${i.username}:${i.password}`)));d(t,a),r({title:"Uspješna prijava",description:`Dobrodošli natrag, ${a.first_name||a.username}!`}),l(c)}else throw new Error("Invalid response")}catch(e){console.error("Login Check Failed:",e),r({title:"Greška pri prijavi",description:"Netočno korisničko ime ili lozinka.",variant:"destructive"})}finally{u(!1)}};return s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsx(S,{title:"Prijava"}),s.jsx("div",{className:"container px-4 py-12 flex justify-center",children:s.jsxs(_,{className:"w-full max-w-md p-6 shadow-xl",children:[s.jsxs("form",{onSubmit:y,className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(h,{htmlFor:"username",children:"Korisničko ime ili Email"}),s.jsx(x,{id:"username",required:!0,value:i.username,onChange:p})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(h,{htmlFor:"password",children:"Lozinka"}),s.jsx(x,{id:"password",type:"password",required:!0,value:i.password,onChange:p})]}),s.jsx(G,{type:"submit",className:"w-full bg-gradient-to-r from-[#0044bf] to-[#ad00e9] text-white font-bold",disabled:m,children:m?s.jsx(P,{className:"w-4 h-4 animate-spin mr-2"}):"Prijavi se"}),s.jsxs("div",{className:"relative my-4",children:[s.jsx("div",{className:"absolute inset-0 flex items-center",children:s.jsx("span",{className:"w-full border-t"})}),s.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:s.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Ili nastavite putem"})})]}),s.jsx("div",{className:"flex justify-center w-full",children:s.jsx(L,{onSuccess:f,onError:()=>{console.log("Login Failed"),r({title:"Greška",description:"Neuspješna prijava putem Google-a.",variant:"destructive"})},useOneTap:!0,theme:"filled_blue",shape:"pill",width:"300"})})]}),s.jsxs("p",{className:"text-center text-sm text-gray-500 mt-4",children:["Nemate račun? ",s.jsx("span",{className:"text-primary font-bold",children:"Pridružite se klikom na gumb u izborniku!"})]})]})})]})};export{q as default};
