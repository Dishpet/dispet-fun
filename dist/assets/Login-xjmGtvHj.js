import{u as v,d as f,b as y,r as u,j as s,a as b,g as p,I as g,B as w,L as N,G as k,h as _,z as G,D as C,E as L}from"./index-adfSeSuF.js";import{P as D}from"./PageHero-BwYl1WG_.js";import"./clouds-top-B3AemNNE.js";const F=()=>{const o=v(),{login:l}=f(),{toast:t}=y(),[c,d]=u.useState(!1),[n,h]=u.useState({username:"",password:""}),m=r=>{const{id:e,value:a}=r.target;h(i=>({...i,[e]:a}))},x=async r=>{try{const e=_(r.credential);console.log("Google User:",e);const a={id:Date.now(),username:e.email.split("@")[0],email:e.email,first_name:e.given_name,last_name:e.family_name,billing:{first_name:e.given_name,last_name:e.family_name,email:e.email,address_1:"",city:"",postcode:"",country:"",phone:""},shipping:{first_name:e.given_name,last_name:e.family_name,address_1:"",city:"",postcode:"",country:""}};try{const i=await G(a);console.log("Synced WP User:",i),a.id=i.id,a.billing={...a.billing,...i.billing},a.shipping={...a.shipping,...i.shipping}}catch(i){console.error("Failed to sync Google User to WP:",i),t({title:"Greška sinkronizacije",description:"Nismo uspjeli povezati vaš račun sa serverom.",variant:"destructive"});return}l("google-session-token",a),t({title:"Uspješna Google prijava",description:`Dobrodošli, ${e.name}!`}),o("/account")}catch(e){console.error("Google Login Error",e),t({title:"Greška",description:"Neuspješna prijava putem Google-a.",variant:"destructive"})}},j=async r=>{r.preventDefault(),d(!0);try{const e=await C(n.username,n.password);if(e&&e.id){let a=e;try{const i=await L(e.id);i&&(a={...e,...i})}catch(i){console.warn("Failed to fetch WC customer details, using basic WP user",i)}l("basic-auth-session",a),t({title:"Uspješna prijava",description:`Dobrodošli natrag, ${a.first_name||a.username}!`}),o("/account")}else throw new Error("Invalid response")}catch(e){console.error("Login Check Failed:",e),t({title:"Greška pri prijavi",description:"Netočno korisničko ime ili lozinka.",variant:"destructive"})}finally{d(!1)}};return s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsx(D,{title:"Prijava"}),s.jsx("div",{className:"container px-4 py-12 flex justify-center",children:s.jsxs(b,{className:"w-full max-w-md p-6 shadow-xl",children:[s.jsxs("form",{onSubmit:j,className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(p,{htmlFor:"username",children:"Korisničko ime ili Email"}),s.jsx(g,{id:"username",required:!0,value:n.username,onChange:m})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(p,{htmlFor:"password",children:"Lozinka"}),s.jsx(g,{id:"password",type:"password",required:!0,value:n.password,onChange:m})]}),s.jsx(w,{type:"submit",className:"w-full bg-gradient-to-r from-[#0044bf] to-[#ad00e9] text-white font-bold",disabled:c,children:c?s.jsx(N,{className:"w-4 h-4 animate-spin mr-2"}):"Prijavi se"}),s.jsxs("div",{className:"relative my-4",children:[s.jsx("div",{className:"absolute inset-0 flex items-center",children:s.jsx("span",{className:"w-full border-t"})}),s.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:s.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Ili nastavite putem"})})]}),s.jsx("div",{className:"flex justify-center w-full",children:s.jsx(k,{onSuccess:x,onError:()=>{console.log("Login Failed"),t({title:"Greška",description:"Neuspješna prijava putem Google-a.",variant:"destructive"})},useOneTap:!0,theme:"filled_blue",shape:"pill",width:"300"})})]}),s.jsxs("p",{className:"text-center text-sm text-gray-500 mt-4",children:["Nemate račun? ",s.jsx("span",{className:"text-primary font-bold",children:"Pridružite se klikom na gumb u izborniku!"})]})]})})]})};export{F as default};
