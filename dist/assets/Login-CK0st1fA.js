import{u as y,s as w,d as b,b as N,r as p,j as s,a as k,g,I as h,B as _,L as G,G as P,h as L,y as C,z as U,D}from"./index-CfEY-HFh.js";import{P as E}from"./PageHero-HVpS2gum.js";import"./clouds-top-B3AemNNE.js";const W=()=>{const o=y(),x=w(),l=new URLSearchParams(x.search).get("redirect")||"/account",{login:c}=b(),{toast:t}=N(),[d,m]=p.useState(!1),[n,j]=p.useState({username:"",password:""}),u=i=>{const{id:e,value:a}=i.target;j(r=>({...r,[e]:a}))},v=async i=>{try{const e=L(i.credential);console.log("Google User:",e);const a={id:Date.now(),username:e.email.split("@")[0],email:e.email,first_name:e.given_name,last_name:e.family_name,billing:{first_name:e.given_name,last_name:e.family_name,email:e.email,address_1:"",city:"",postcode:"",country:"",phone:""},shipping:{first_name:e.given_name,last_name:e.family_name,address_1:"",city:"",postcode:"",country:""}};try{const r=await C(a);console.log("Synced WP User:",r),a.id=r.id,a.billing={...a.billing,...r.billing},a.shipping={...a.shipping,...r.shipping}}catch(r){console.error("Failed to sync Google User to WP:",r),t({title:"Greška sinkronizacije",description:"Nismo uspjeli povezati vaš račun sa serverom.",variant:"destructive"});return}c("google-session-token",a),t({title:"Uspješna Google prijava",description:`Dobrodošli, ${e.name}!`}),o(l)}catch(e){console.error("Google Login Error",e),t({title:"Greška",description:"Neuspješna prijava putem Google-a.",variant:"destructive"})}},f=async i=>{i.preventDefault(),m(!0);try{const e=await U(n.username,n.password);if(e&&e.id){let a=e;try{const r=await D(e.id);r&&(a={...e,...r})}catch(r){console.warn("Failed to fetch WC customer details, using basic WP user",r)}c("basic-auth-session",a),t({title:"Uspješna prijava",description:`Dobrodošli natrag, ${a.first_name||a.username}!`}),o(l)}else throw new Error("Invalid response")}catch(e){console.error("Login Check Failed:",e),t({title:"Greška pri prijavi",description:"Netočno korisničko ime ili lozinka.",variant:"destructive"})}finally{m(!1)}};return s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsx(E,{title:"Prijava"}),s.jsx("div",{className:"container px-4 py-12 flex justify-center",children:s.jsxs(k,{className:"w-full max-w-md p-6 shadow-xl",children:[s.jsxs("form",{onSubmit:f,className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(g,{htmlFor:"username",children:"Korisničko ime ili Email"}),s.jsx(h,{id:"username",required:!0,value:n.username,onChange:u})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(g,{htmlFor:"password",children:"Lozinka"}),s.jsx(h,{id:"password",type:"password",required:!0,value:n.password,onChange:u})]}),s.jsx(_,{type:"submit",className:"w-full bg-gradient-to-r from-[#0044bf] to-[#ad00e9] text-white font-bold",disabled:d,children:d?s.jsx(G,{className:"w-4 h-4 animate-spin mr-2"}):"Prijavi se"}),s.jsxs("div",{className:"relative my-4",children:[s.jsx("div",{className:"absolute inset-0 flex items-center",children:s.jsx("span",{className:"w-full border-t"})}),s.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:s.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Ili nastavite putem"})})]}),s.jsx("div",{className:"flex justify-center w-full",children:s.jsx(P,{onSuccess:v,onError:()=>{console.log("Login Failed"),t({title:"Greška",description:"Neuspješna prijava putem Google-a.",variant:"destructive"})},useOneTap:!0,theme:"filled_blue",shape:"pill",width:"300"})})]}),s.jsxs("p",{className:"text-center text-sm text-gray-500 mt-4",children:["Nemate račun? ",s.jsx("span",{className:"text-primary font-bold",children:"Pridružite se klikom na gumb u izborniku!"})]})]})})]})};export{W as default};
