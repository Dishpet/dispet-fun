import{l as M,aw as P,T as S,r as m,b as T,j as e,B as f,L as N,n as C,C as U,aq as L,X as k}from"./index-Fa1edKbd.js";import{C as z,a as D}from"./collapsible-DSEMOaYD.js";import{C as F}from"./check-CL5Rsc1Q.js";import{C as R}from"./chevron-right-xsIjxwgi.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=M("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),B=async(t=1,r=20)=>{const n=`/wp/v2/media?page=${t}&per_page=${r}`,i=await fetch(`${P}${n}`,{headers:{...S()}});if(!i.ok)throw new Error(`WordPress API Error: ${i.statusText}`);const o=parseInt(i.headers.get("X-WP-TotalPages")||"1",10);return{data:await i.json(),totalPages:o}},H=async t=>{const r=S();new FormData().append("file",t);const i=`${P}/wp/v2/media`,o=r.Authorization,d=await fetch(i,{method:"POST",headers:{Authorization:o,"Content-Disposition":`attachment; filename="${t.name}"`,"Content-Type":t.type},body:t});if(!d.ok)throw new Error(`Media Upload Error: ${d.statusText}`);return d.json()},O=24,W=({onSelect:t,multiSelect:r=!1})=>{const[n,i]=m.useState([]),[o,d]=m.useState(!0),[x,g]=m.useState(!1),[l,c]=m.useState([]),[p,b]=m.useState(1),[j,y]=m.useState(1),{toast:w}=T();m.useEffect(()=>{A(p)},[p]);const A=async s=>{d(!0);try{const{data:a,totalPages:h}=await B(s,O);i(a),y(h)}catch(a){console.error(a),w({title:"Error",description:"Failed to load media",variant:"destructive"})}finally{d(!1)}},E=()=>{p<j&&b(s=>s+1)},_=()=>{p>1&&b(s=>s-1)},$=async s=>{if(!s.target.files||s.target.files.length===0)return;const a=s.target.files[0];g(!0);try{const h=await H(a);i([h,...n]),w({title:"Success",description:"Image uploaded successfully"})}catch(h){console.error(h),w({title:"Error",description:"Upload failed",variant:"destructive"})}finally{g(!1)}},I=s=>{let a;r?l.some(u=>u.id===s.id)?a=l.filter(u=>u.id!==s.id):a=[...l,s]:a=[s],c(a),t&&t(r?a:a[0])},v=s=>l.some(a=>a.id===s);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-[10px] font-black uppercase text-slate-400 tracking-[0.2em] ml-1",children:"Media Library"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{className:"text-sm text-gray-500 mr-2",children:l.length>0?`${l.length} selected`:""}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:"image/*",id:"media-upload",className:"hidden",onChange:$,disabled:x}),e.jsx("label",{htmlFor:"media-upload",children:e.jsx(f,{variant:"outline",size:"sm",className:"cursor-pointer rounded-full h-10 px-6 font-bold text-xs uppercase tracking-wider",asChild:!0,disabled:x,children:e.jsxs("span",{children:[x?e.jsx(N,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(q,{className:"w-4 h-4 mr-2"}),"Upload"]})})})]})]})]}),e.jsx("div",{className:"bg-slate-50 border-none rounded-[2rem] p-6 min-h-[400px] flex flex-col shadow-inner",children:o?e.jsx("div",{className:"flex-1 flex items-center justify-center min-h-[300px]",children:e.jsx(N,{className:"w-8 h-8 animate-spin text-gray-400"})}):e.jsxs(e.Fragment,{children:[n.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-4",children:n.map(s=>{var a,h,u;return e.jsxs("div",{className:C("relative aspect-square rounded-2xl overflow-hidden border-2 cursor-pointer transition-all group bg-white shadow-sm",v(s.id)?"border-primary ring-2 ring-primary/20":"border-transparent hover:border-gray-300"),onClick:()=>I(s),children:[e.jsx("img",{src:((u=(h=(a=s.media_details)==null?void 0:a.sizes)==null?void 0:h.thumbnail)==null?void 0:u.source_url)||s.source_url,alt:s.title.rendered,className:"w-full h-full object-cover"}),v(s.id)&&e.jsx("div",{className:"absolute inset-0 bg-primary/20 flex items-center justify-center",children:e.jsx("div",{className:"bg-white rounded-full p-1",children:e.jsx(F,{className:"w-4 h-4 text-primary"})})})]},s.id)})}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-400",children:"No media found on this page."}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-gray-200 mt-auto",children:[e.jsxs(f,{variant:"ghost",size:"sm",className:"rounded-full h-10 px-6 font-bold text-xs uppercase tracking-wider bg-white shadow-sm hover:bg-slate-100",onClick:_,disabled:p<=1||o,children:[e.jsx(U,{className:"w-4 h-4 mr-1"})," Prethodna"]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Page ",p," of ",j||1]}),e.jsxs(f,{variant:"ghost",size:"sm",className:"rounded-full h-10 px-6 font-bold text-xs uppercase tracking-wider bg-white shadow-sm hover:bg-slate-100",onClick:E,disabled:p>=j||o,children:["Sljedeća ",e.jsx(R,{className:"w-4 h-4 ml-1"})]})]})]})})]})},J=({value:t,onChange:r,onSelectMedia:n,multiple:i=!1})=>{const[o,d]=m.useState(!1),x=l=>{if(i){const c=Array.isArray(l)?l:[l];r&&r(c.map(p=>p.source_url)),n&&n(c)}else{const c=l;r&&r(c.source_url),n&&n(c),d(!1)}},g=()=>t?Array.isArray(t)?t.length===0?null:e.jsx("div",{className:"grid grid-cols-3 gap-2",children:t.map((l,c)=>e.jsxs("div",{className:"relative aspect-square bg-gray-100 rounded-lg overflow-hidden border border-gray-200 group",children:[e.jsx("img",{src:l,alt:`Selected ${c}`,className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",onClick:p=>{p.preventDefault();const b=t.filter((j,y)=>y!==c);r&&r(b)},children:e.jsx(k,{className:"w-3 h-3"})})]},c))}):e.jsxs("div",{className:"relative w-full h-48 bg-gray-100 rounded-lg overflow-hidden border border-gray-200 group",children:[e.jsx("img",{src:t,alt:"Selected",className:"w-full h-full object-contain"}),e.jsx("button",{type:"button",className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",onClick:l=>{l.preventDefault(),r&&r("")},children:e.jsx(k,{className:"w-4 h-4"})})]}):null;return e.jsxs("div",{className:"space-y-4",children:[g(),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(f,{variant:"outline",type:"button",onClick:()=>d(!o),className:C("w-full h-12 rounded-xl font-bold text-xs uppercase tracking-wider border-slate-200 transition-all",o?"bg-slate-100":"hover:bg-slate-50"),children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),o?"Zatvori Galeriju":t&&(Array.isArray(t)?t.length>0:t)?"Promijeni Sliku":"Odaberi Sliku"]}),e.jsx(z,{open:o,children:e.jsx(D,{children:e.jsxs("div",{className:"bg-slate-50 p-4 rounded-2xl border border-slate-200 mt-2 animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 px-2",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase text-slate-400 tracking-[0.2em]",children:"Medijska Biblioteka"}),i&&e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>d(!1),className:"h-8 rounded-lg font-bold text-[10px] uppercase tracking-wider text-primary",children:"Završi odabir"})]}),e.jsx("div",{className:"max-h-[500px] overflow-y-auto pr-2 custom-scrollbar",children:e.jsx(W,{onSelect:x,multiSelect:i})})]})})})]})]})};export{J as M,q as U};
