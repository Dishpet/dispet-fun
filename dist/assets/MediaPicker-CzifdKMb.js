import{k as _,ay as S,V as k,r as u,a as M,j as e,B as x,L as N,l as T,C as $,K as U,M as L,as as z,N as F,Q as R,X as P}from"./index-D1OsYnNr.js";import{C as H}from"./check-CaxXhw6Q.js";import{C as O}from"./chevron-right-BMsYNXSN.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=_("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),q=async(a=1,r=20)=>{const o=`/wp/v2/media?page=${a}&per_page=${r}`,i=await fetch(`${S}${o}`,{headers:{...k()}});if(!i.ok)throw new Error(`WordPress API Error: ${i.statusText}`);const h=parseInt(i.headers.get("X-WP-TotalPages")||"1",10);return{data:await i.json(),totalPages:h}},B=async a=>{const r=k();new FormData().append("file",a);const i=`${S}/wp/v2/media`,h=r.Authorization,n=await fetch(i,{method:"POST",headers:{Authorization:h,"Content-Disposition":`attachment; filename="${a.name}"`,"Content-Type":a.type},body:a});if(!n.ok)throw new Error(`Media Upload Error: ${n.statusText}`);return n.json()},V=24,X=({onSelect:a,multiSelect:r=!1})=>{const[o,i]=u.useState([]),[h,n]=u.useState(!0),[f,g]=u.useState(!1),[l,c]=u.useState([]),[d,j]=u.useState(1),[y,w]=u.useState(1),{toast:v}=M();u.useEffect(()=>{C(d)},[d]);const C=async s=>{n(!0);try{const{data:t,totalPages:m}=await q(s,V);i(t),w(m)}catch(t){console.error(t),v({title:"Error",description:"Failed to load media",variant:"destructive"})}finally{n(!1)}},A=()=>{d<y&&j(s=>s+1)},E=()=>{d>1&&j(s=>s-1)},D=async s=>{if(!s.target.files||s.target.files.length===0)return;const t=s.target.files[0];g(!0);try{const m=await B(t);i([m,...o]),v({title:"Success",description:"Image uploaded successfully"})}catch(m){console.error(m),v({title:"Error",description:"Upload failed",variant:"destructive"})}finally{g(!1)}},I=s=>{let t;r?l.some(p=>p.id===s.id)?t=l.filter(p=>p.id!==s.id):t=[...l,s]:t=[s],c(t),a&&a(r?t:t[0])},b=s=>l.some(t=>t.id===s);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Media Library"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{className:"text-sm text-gray-500 mr-2",children:l.length>0?`${l.length} selected`:""}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:"image/*",id:"media-upload",className:"hidden",onChange:D,disabled:f}),e.jsx("label",{htmlFor:"media-upload",children:e.jsx(x,{variant:"outline",size:"sm",className:"cursor-pointer",asChild:!0,disabled:f,children:e.jsxs("span",{children:[f?e.jsx(N,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(W,{className:"w-4 h-4 mr-2"}),"Upload"]})})})]})]})]}),e.jsx("div",{className:"bg-gray-50 border rounded-lg p-4 min-h-[400px] flex flex-col",children:h?e.jsx("div",{className:"flex-1 flex items-center justify-center min-h-[300px]",children:e.jsx(N,{className:"w-8 h-8 animate-spin text-gray-400"})}):e.jsxs(e.Fragment,{children:[o.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-4",children:o.map(s=>{var t,m,p;return e.jsxs("div",{className:T("relative aspect-square rounded-lg overflow-hidden border-2 cursor-pointer transition-all group bg-white",b(s.id)?"border-primary ring-2 ring-primary/20":"border-transparent hover:border-gray-300"),onClick:()=>I(s),children:[e.jsx("img",{src:((p=(m=(t=s.media_details)==null?void 0:t.sizes)==null?void 0:m.thumbnail)==null?void 0:p.source_url)||s.source_url,alt:s.title.rendered,className:"w-full h-full object-cover"}),b(s.id)&&e.jsx("div",{className:"absolute inset-0 bg-primary/20 flex items-center justify-center",children:e.jsx("div",{className:"bg-white rounded-full p-1",children:e.jsx(H,{className:"w-4 h-4 text-primary"})})})]},s.id)})}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-400",children:"No media found on this page."}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-gray-200 mt-auto",children:[e.jsxs(x,{variant:"outline",size:"sm",onClick:E,disabled:d<=1||h,children:[e.jsx($,{className:"w-4 h-4 mr-1"})," Previous"]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Page ",d," of ",y||1]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:A,disabled:d>=y||h,children:["Next ",e.jsx(O,{className:"w-4 h-4 ml-1"})]})]})]})})]})},J=({value:a,onChange:r,onSelectMedia:o,multiple:i=!1})=>{const[h,n]=u.useState(!1),f=l=>{if(i){const c=Array.isArray(l)?l:[l];r&&r(c.map(d=>d.source_url)),o&&o(c)}else{const c=l;r&&r(c.source_url),o&&o(c),n(!1)}},g=()=>a?Array.isArray(a)?a.length===0?null:e.jsx("div",{className:"grid grid-cols-3 gap-2",children:a.map((l,c)=>e.jsxs("div",{className:"relative aspect-square bg-gray-100 rounded-lg overflow-hidden border border-gray-200 group",children:[e.jsx("img",{src:l,alt:`Selected ${c}`,className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",onClick:d=>{d.preventDefault();const j=a.filter((y,w)=>w!==c);r&&r(j)},children:e.jsx(P,{className:"w-3 h-3"})})]},c))}):e.jsxs("div",{className:"relative w-full h-48 bg-gray-100 rounded-lg overflow-hidden border border-gray-200 group",children:[e.jsx("img",{src:a,alt:"Selected",className:"w-full h-full object-contain"}),e.jsx("button",{type:"button",className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",onClick:l=>{l.preventDefault(),r&&r("")},children:e.jsx(P,{className:"w-4 h-4"})})]}):null;return e.jsxs("div",{className:"space-y-4",children:[g(),e.jsxs(U,{open:h,onOpenChange:n,children:[e.jsx(L,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:"w-full",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),a&&(Array.isArray(a)?a.length>0:a)?"Change Image(s)":"Select Image(s)"]})}),e.jsxs(F,{className:"w-[90vw] max-w-[90vw] sm:w-full sm:max-w-4xl max-h-[90vh] overflow-y-auto p-4 sm:p-6 overflow-x-hidden",children:[e.jsx(R,{children:"Select Media"}),e.jsx(X,{onSelect:f,multiSelect:i}),i&&e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(x,{onClick:()=>n(!1),children:"Done"})})]})]})]})};export{J as M,W as U};
