import{k as I,r as c,a as L,j as e,B as p,L as S,V,W as b,u as $,K as B,M as O,N as q,I as C,q as R,Y as M,Z as U,_ as W}from"./index-D1OsYnNr.js";import{B as H}from"./badge-3ERzNLBD.js";import{C as D,a as J,b as K,d as Q,c as X}from"./card-BkJhaAGP.js";import{C as Y,a as Z,b as G,c as ee}from"./collapsible-BFES2X_9.js";import{R as se}from"./refresh-cw-C0WCVY3X.js";import{P as te}from"./plus-Brw27b8I.js";import{P as k}from"./package-DcRVcL9D.js";import{S as ae}from"./square-pen-Wm_g27Om.js";import{T as re}from"./trash-2-jHaqMneL.js";import{S as ie}from"./save-D8RbCv3N.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=I("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),oe=[{name:"Veličina",slug:"pa_size",type:"select",order_by:"menu_order",has_archives:!1,terms:["6-8 g.","8-10 g.","10-12 g.","S","M","L","XL"]},{name:"Boja",slug:"pa_color",type:"select",order_by:"name",has_archives:!1,terms:["Crna","Siva","Tirkizna","Cijan","Plava","Ljubičasta","Bijela","Roza","Mint"]},{name:"Dizajn",slug:"pa_design",type:"select",order_by:"name",has_archives:!1,terms:["Street 1","Street 2","Street 3","Street 4","Street 5","Street 6","Street 7","Street 8","Street 9","Street 10","Vintage 1","Vintage 2","Vintage 3","Vintage 4","Vintage 5","Logo 1","Logo 2","Logo 3","Logo 4","Logo 5","Logo 6","Logo 7","Logo 8","Logo 9","Logo 10","Logo 11","Logo 12","Kids Badge","Street Badge","Vintage Badge"]}],ce=()=>{const[s,x]=c.useState(!1),[y,j]=c.useState([]),{toast:d}=L(),i=t=>j(l=>[...l,`${new Date().toLocaleTimeString()} - ${t}`]),g=async()=>{x(!0),j([]),i("Starting attribute synchronization...");try{const t=V();i("Fetching existing attributes...");const l=await b("/wc/v3/products/attributes",{headers:t});for(const n of oe){let o;const a=l.find(m=>m.slug===n.slug);if(a?(o=a.id,i(`Attribute '${n.name}' already exists (ID: ${o}).`)):(i(`Creating attribute '${n.name}'...`),o=(await b("/wc/v3/products/attributes",{method:"POST",headers:t,body:JSON.stringify({name:n.name,slug:n.slug,type:n.type,order_by:n.order_by,has_archives:n.has_archives})})).id,i(`Created attribute '${n.name}' (ID: ${o}).`)),o){i(`Syncing terms for '${n.name}'...`);const N=(await b(`/wc/v3/products/attributes/${o}/terms?per_page=100`,{headers:t})).map(h=>h.name);for(const h of n.terms)if(!N.includes(h))try{await b(`/wc/v3/products/attributes/${o}/terms`,{method:"POST",headers:t,body:JSON.stringify({name:h})}),i(`  + Added term: ${h}`)}catch(w){i(`  ! Failed to add term ${h}: ${w.message}`)}}}i("Synchronization complete!"),d({title:"Success",description:"Attributes synced successfully."})}catch(t){console.error("Sync failed:",t),i(`Error: ${t.message}`),d({title:"Error",description:"Sync failed. Check console.",variant:"destructive"})}finally{x(!1)}};return e.jsxs(D,{children:[e.jsxs(J,{children:[e.jsx(K,{className:"text-lg",children:"WooCommerce Attributes Sync"}),e.jsx(Q,{children:"Automatically create Attributes (Size, Color, Design) and their Terms in WooCommerce to match your site options."})]}),e.jsxs(X,{children:[e.jsxs(p,{onClick:g,disabled:s,className:"w-full sm:w-auto",children:[s?e.jsx(S,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(se,{className:"w-4 h-4 mr-2"}),s?"Syncing...":"Sync Attributes Now"]}),y.length>0&&e.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-md border text-xs font-mono max-h-60 overflow-y-auto space-y-1",children:y.map((t,l)=>e.jsx("div",{className:"flex gap-2",children:e.jsx("span",{className:t.includes("Error")||t.includes("Failed")?"text-red-500":"text-gray-600",children:t})},l))})]})]})},T={Crna:"#231f20",Siva:"#d1d5db",Tirkizna:"#00ab98",Cijan:"#00aeef",Plava:"#387bbf",Ljubičasta:"#8358a4",Bijela:"#ffffff",Roza:"#e78fab",Mint:"#a1d7c0"},le=({product:s,onDelete:x,onUpdate:y})=>{var P;const j=$(),{toast:d}=L(),[i,g]=c.useState(!1),[t,l]=c.useState([]),[n,o]=c.useState(!1),[a,m]=c.useState(!1),[N,h]=c.useState(s.stock_quantity||0),[w,_]=c.useState({}),v=s.type==="variable",E=async()=>{if(!i&&v&&t.length===0){o(!0);try{const r=await M(s.id);l(r);const u={};r.forEach(f=>{u[f.id]=f.stock_quantity||0}),_(u)}catch(r){console.error("Failed to fetch variations",r),d({title:"Error",description:"Failed to fetch variations",variant:"destructive"})}finally{o(!1)}}g(!i)},z=async()=>{m(!0);try{v||await U(s.id,{manage_stock:!0,stock_quantity:N}),v&&t.length>0&&await Promise.all(t.map(r=>W(s.id,r.id,{manage_stock:!0,stock_quantity:w[r.id]}))),d({title:"Success",description:"Stock updated successfully"}),y()}catch(r){console.error(r),d({title:"Error",description:"Failed to update stock",variant:"destructive"})}finally{m(!1)}};return e.jsxs(D,{className:"mb-4 overflow-hidden border-border/60 shadow-sm hover:shadow-md transition-all",children:[e.jsxs("div",{className:"p-4 flex flex-col md:flex-row items-start md:items-center gap-4",children:[e.jsx("div",{className:"h-16 w-16 rounded-md bg-gray-100 flex-shrink-0 overflow-hidden border",children:(P=s.images)!=null&&P[0]?e.jsx("img",{src:s.images[0].src,alt:s.name,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center text-gray-400",children:e.jsx(k,{className:"w-8 h-8 opacity-50"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:s.name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1",children:[e.jsx(H,{variant:s.stock_status==="instock"?"default":"destructive",className:"text-xs px-2 py-0.5",children:s.stock_status==="instock"?"In Stock":"Out of Stock"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["ID: ",s.id]}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["€",s.price]})]})]}),!v&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase",children:"Stock:"}),e.jsx(C,{type:"number",className:"w-24 h-9",value:N,onChange:r=>h(parseInt(r.target.value)||0)})]}),e.jsxs("div",{className:"flex items-center gap-2 self-end md:self-auto",children:[v&&e.jsxs(p,{variant:"outline",size:"sm",onClick:E,className:"gap-2",children:[i?e.jsx(Y,{className:"w-4 h-4"}):e.jsx(Z,{className:"w-4 h-4"}),"Variations"]}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>j(`/admin/products/edit/${s.id}`),children:e.jsx(ae,{className:"w-4 h-4 text-blue-600"})}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>x(s.id),children:e.jsx(re,{className:"w-4 h-4 text-red-600"})}),e.jsx(p,{onClick:z,disabled:a,size:"sm",className:a?"opacity-70":"",children:a?e.jsx(S,{className:"w-4 h-4 animate-spin"}):e.jsx(ie,{className:"w-4 h-4"})})]})]}),e.jsx(G,{open:i,className:"bg-gray-50/50 border-t",children:e.jsx(ee,{children:e.jsx("div",{className:"p-4 space-y-3",children:n?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(S,{className:"w-6 h-6 animate-spin text-primary"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 px-2 text-xs font-medium text-gray-500 uppercase tracking-wider mb-2",children:[e.jsx("div",{className:"col-span-6 md:col-span-8",children:"Variation"}),e.jsx("div",{className:"col-span-6 md:col-span-4",children:"Stock"})]}),t.map(r=>e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center bg-white p-3 rounded-md border shadow-sm",children:[e.jsxs("div",{className:"col-span-6 md:col-span-8 flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[(()=>{var A;const u=(A=r.attributes)==null?void 0:A.find(F=>T[F.option]),f=u?T[u.option]:null;return f?e.jsx("div",{className:"w-3 h-3 rounded-full border border-gray-300 shadow-sm shrink-0",style:{backgroundColor:f}}):null})(),e.jsx("span",{className:"font-medium text-gray-900",children:r.attributes.map(u=>`${u.option}`).join(" / ")})]}),e.jsxs("span",{className:"text-xs text-gray-500 ml-5",children:["ID: ",r.id," • €",r.price]})]}),e.jsx("div",{className:"col-span-6 md:col-span-4",children:e.jsx(C,{type:"number",className:"h-8",value:w[r.id]||0,onChange:u=>_(f=>({...f,[r.id]:parseInt(u.target.value)||0}))})})]},r.id))]})})})})]})},ve=()=>{const[s,x]=c.useState([]),[y,j]=c.useState(!0),[d,i]=c.useState(""),{toast:g}=L(),t=$(),l=async()=>{try{const a=await R(1,100);x(a)}catch(a){console.error("Failed to fetch products:",a),g({title:"Error",description:"Failed to load products.",variant:"destructive"})}finally{j(!1)}};c.useEffect(()=>{l()},[]);const n=async a=>{if(confirm("Are you sure you want to delete this product?"))try{await b(`/wc/v3/products/${a}?force=true`,{method:"DELETE",headers:V()}),x(s.filter(m=>m.id!==a)),g({title:"Success",description:"Product deleted successfully"})}catch{g({title:"Error",description:"Failed to delete product",variant:"destructive"})}},o=s.filter(a=>a.name.toLowerCase().includes(d.toLowerCase()));return e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold font-heading bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent",children:"Products"}),e.jsx("p",{className:"text-muted-foreground mt-1 text-lg",children:"Manage your catalog and stock inventory."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(B,{children:[e.jsx(O,{asChild:!0,children:e.jsx(p,{variant:"outline",className:"shadow-sm hover:shadow-md transition-all",children:"Setup Attributes"})}),e.jsx(q,{className:"sm:max-w-md",children:e.jsx(ce,{})})]}),e.jsxs(p,{onClick:()=>t("/admin/products/new"),className:"shadow-lg hover:shadow-xl transition-all",children:[e.jsx(te,{className:"w-4 h-4 mr-2"})," New Product"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 bg-white p-2 rounded-lg border shadow-sm max-w-md",children:[e.jsx(ne,{className:"w-5 h-5 text-gray-400 ml-2"}),e.jsx(C,{placeholder:"Search products...",value:d,onChange:a=>i(a.target.value),className:"border-none shadow-none focus-visible:ring-0"})]}),e.jsx("div",{className:"space-y-4",children:y?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 animate-pulse",children:[e.jsx(k,{className:"w-12 h-12 text-gray-200 mb-4"}),e.jsx("p",{className:"text-gray-400 font-medium",children:"Loading inventory..."})]}):e.jsxs(e.Fragment,{children:[o.map(a=>e.jsx(le,{product:a,onDelete:n,onUpdate:l},a.id)),o.length===0&&e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border border-dashed",children:[e.jsx(k,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"No products found matching your search."})]})]})})]})};export{ve as default};
