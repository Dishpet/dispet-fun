import{_ as le,a as ae,b as oe,c as re,d as ie,e as ne,f as ce,g as de,h as ge,i as xe,j as me,y as he,z as ue,A as _e,B as pe,C as fe,k as be,l as ve,m as je,n as Ne,o as Ce,p as we,q as ke,r as ye,s as Se,t as Le,u as Re,v as Ae,w as Te,x as ze}from"./logo-9-DeVPud_4.js";import{l as q,r as x,b as De,d as Ee,j as e,L as O,B as c,a as C,F as w,J as k,K as y,g as d,I as $,aq as Pe,X as S}from"./index-B2PMnJlA.js";import{S as F,W as Be}from"./switch-6doy632L.js";import{T as Oe,a as $e,b as L,c as Fe}from"./tabs-DKuQ1Jx2.js";import{R as Ie}from"./refresh-ccw-B-wMrVum.js";import{S as Ge}from"./save-BpR-fmeQ.js";import{P as I}from"./palette-ByM5PjOB.js";import{C as Ve}from"./clock-BEgkkyRx.js";import{C as qe}from"./check-C42NFqfc.js";import{P as Ue}from"./plus-CcZGilYd.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=q("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=q("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]),G="/api",Ke=Object.assign({"/src/assets/design-collections/street/street-1.png":le,"/src/assets/design-collections/street/street-10.png":ae,"/src/assets/design-collections/street/street-2.png":oe,"/src/assets/design-collections/street/street-3-alt.png":re,"/src/assets/design-collections/street/street-3.png":ie,"/src/assets/design-collections/street/street-4.png":ne,"/src/assets/design-collections/street/street-5.png":ce,"/src/assets/design-collections/street/street-6.png":de,"/src/assets/design-collections/street/street-7.png":ge,"/src/assets/design-collections/street/street-8.png":xe,"/src/assets/design-collections/street/street-9.png":me}),Me=Object.assign({"/src/assets/design-collections/vintage/vintage-1.png":he,"/src/assets/design-collections/vintage/vintage-2.png":ue,"/src/assets/design-collections/vintage/vintage-3.png":_e,"/src/assets/design-collections/vintage/vintage-4.png":pe,"/src/assets/design-collections/vintage/vintage-5.png":fe}),Ze=Object.assign({"/src/assets/design-collections/logo/KIDS-BADGE.png":be,"/src/assets/design-collections/logo/STREET-BADGE.png":ve,"/src/assets/design-collections/logo/VINTAGE-BADGE.png":je,"/src/assets/design-collections/logo/logo-1.png":Ne,"/src/assets/design-collections/logo/logo-10.png":Ce,"/src/assets/design-collections/logo/logo-11.png":we,"/src/assets/design-collections/logo/logo-12.png":ke,"/src/assets/design-collections/logo/logo-3.png":ye,"/src/assets/design-collections/logo/logo-4.png":Se,"/src/assets/design-collections/logo/logo-5.png":Le,"/src/assets/design-collections/logo/logo-6.png":Re,"/src/assets/design-collections/logo/logo-7.png":Ae,"/src/assets/design-collections/logo/logo-8.png":Te,"/src/assets/design-collections/logo/logo-9.png":ze}),R=p=>Object.entries(p).map(([_,f])=>({path:_,url:f,filename:_.split("/").pop()||""})),V={Street:R(Ke),Vintage:R(Me),Logo:R(Ze)},u=[{name:"Crna",hex:"#231f20"},{name:"Siva",hex:"#d1d5db"},{name:"Tirkizna",hex:"#00ab98"},{name:"Cijan",hex:"#00aeef"},{name:"Plava",hex:"#387bbf"},{name:"Ljubičasta",hex:"#8358a4"},{name:"Bijela",hex:"#ffffff"},{name:"Roza",hex:"#e78fab"},{name:"Mint",hex:"#a1d7c0"}],A={tshirt:"T-Shirt",hoodie:"Hoodie",cap:"Cap",bottle:"Bottle"},rs=()=>{const[p,_]=x.useState(!0),[f,T]=x.useState(!1),[l,m]=x.useState(null),[g,U]=x.useState("tshirt"),[j,W]=x.useState("Street"),[r,z]=x.useState(null),[D,J]=x.useState("#231f20"),{toast:b}=De(),{token:v}=Ee();x.useEffect(()=>{N()},[]);const N=async()=>{var s;_(!0);try{const t=await fetch(`${G}/antigravity/v1/shop-config`);if(!t.ok)throw new Error("Failed to fetch config");const a=await t.json();console.log("[ShopRules] Fetched config:",a),console.log("[ShopRules] T-shirt allowed_colors from server:",(s=a.tshirt)==null?void 0:s.allowed_colors),m(a)}catch(t){console.error("Failed to fetch shop config:",t),b({title:"Error",description:"Failed to load configuration",variant:"destructive"})}finally{_(!1)}},K=async()=>{var s,t;if(l){T(!0);try{if(console.log("[ShopRules] Saving config, token:",v?`${v.substring(0,20)}...`:"NULL"),console.log("[ShopRules] Config being sent:",JSON.stringify(l,null,2)),console.log("[ShopRules] T-shirt allowed_colors:",(s=l.tshirt)==null?void 0:s.allowed_colors),console.log("[ShopRules] T-shirt restricted_designs:",(t=l.tshirt)==null?void 0:t.restricted_designs),!v)throw new Error("You must be logged in to save changes.");const a=await fetch(`${G}/antigravity/v1/shop-config`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Basic ${v}`},body:JSON.stringify(l)});console.log("[ShopRules] Save response status:",a.status);const o=await a.json();if(console.log("[ShopRules] Server response:",o),!a.ok)throw new Error(o.message||"Failed to save");b({title:"Saved!",description:"Shop configuration updated successfully."})}catch(a){console.error("Failed to save shop config:",a),b({title:"Error",description:a.message||"Failed to save configuration",variant:"destructive"})}finally{T(!1)}}},M=s=>{if(!l)return;const t=l[g],a=t.allowed_colors.includes(s);m({...l,[g]:{...t,allowed_colors:a?t.allowed_colors.filter(o=>o!==s):[...t.allowed_colors,s]}})},Z=(s,t)=>{if(!l)return;const a=l.design_color_map[s]||u.map(n=>n.hex),o=a.includes(t);m({...l,design_color_map:{...l.design_color_map,[s]:o?a.filter(n=>n!==t):[...a,t]}})},X=s=>{if(!l)return;const t=l[g],a=t.restricted_designs.includes(s);m({...l,[g]:{...t,restricted_designs:a?t.restricted_designs.filter(o=>o!==s):[...t.restricted_designs,s]}})},h=(s,t)=>{l&&m({...l,[g]:{...l[g],[s]:t}})},Y=()=>{if(!l||!r)return;if(l.alternatives.find(t=>t.design_id===r)){b({title:"Already exists",description:"This design already has an alternative rule."});return}m({...l,alternatives:[...l.alternatives,{design_id:r,trigger_colors:[],replace_with:""}]})},E=(s,t,a)=>{l&&m({...l,alternatives:l.alternatives.map(o=>o.design_id===s?{...o,[t]:a}:o)})},Q=(s,t)=>{if(!l)return;const a=l.alternatives.find(n=>n.design_id===s);if(!a)return;const o=a.trigger_colors.includes(t);E(s,"trigger_colors",o?a.trigger_colors.filter(n=>n!==t):[...a.trigger_colors,t])},H=s=>{l&&m({...l,alternatives:l.alternatives.filter(t=>t.design_id!==s)})},ee=x.useMemo(()=>V[j],[j]),se=s=>l?l.design_color_map[s]||u.map(t=>t.hex):u.map(t=>t.hex),P=s=>l?l[g].restricted_designs.includes(s):!1,B=s=>l&&l.alternatives.find(t=>t.design_id===s)||null;if(p)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(O,{className:"w-8 h-8 animate-spin text-primary"})});if(!l)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-4",children:[e.jsx("p",{className:"text-slate-500",children:"Failed to load configuration."}),e.jsx(c,{onClick:N,children:"Retry"})]});const i=l[g];return e.jsxs("div",{className:"space-y-6 animate-fade-in pb-10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4 border-b border-slate-200/60 pb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl md:text-4xl font-black font-heading text-slate-900 tracking-tight uppercase",children:"Shop Rules"}),e.jsx("p",{className:"text-slate-500 text-sm md:text-lg font-medium mt-1",children:"Configure colors, designs, and cycle logic per product."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",onClick:N,disabled:p,children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"})," Refresh"]}),e.jsxs(c,{onClick:K,disabled:f,children:[f?e.jsx(O,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Ge,{className:"w-4 h-4 mr-2"}),"Save Changes"]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["tshirt","hoodie","cap","bottle"].map(s=>e.jsx(c,{variant:g===s?"default":"outline",onClick:()=>U(s),className:"font-bold",children:A[s]},s))}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs(C,{className:"rounded-2xl border-slate-100 shadow-lg lg:col-span-1",children:[e.jsx(w,{className:"pb-4 border-b border-slate-100",children:e.jsxs(k,{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5 text-blue-500"}),A[g]," Settings"]})}),e.jsxs(y,{className:"pt-4 space-y-5",children:[e.jsxs("div",{children:[e.jsxs(d,{className:"text-sm font-semibold text-slate-700 flex items-center gap-2 mb-2",children:[e.jsx(I,{className:"w-4 h-4"})," Product Colors"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.map(s=>{const t=i.allowed_colors.includes(s.hex);return e.jsx("button",{onClick:()=>M(s.hex),className:`w-7 h-7 rounded-full border-2 transition-all ${t?"border-blue-500 ring-2 ring-blue-200":"border-slate-300 opacity-40"}`,style:{backgroundColor:s.hex},title:s.name},s.hex)})})]}),i.has_front_back&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-slate-700 mb-2 block",children:"Default Zone"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:i.default_zone==="front"?"default":"outline",size:"sm",onClick:()=>h("default_zone","front"),children:"Front"}),e.jsx(c,{variant:i.default_zone==="back"?"default":"outline",size:"sm",onClick:()=>h("default_zone","back"),children:"Back"})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-slate-700 mb-2 block",children:"Locked Zone"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:i.locked_zone==="front"?"default":"outline",size:"sm",onClick:()=>h("locked_zone","front"),children:"Front"}),e.jsx(c,{variant:i.locked_zone==="back"?"default":"outline",size:"sm",onClick:()=>h("locked_zone","back"),children:"Back"}),e.jsx(c,{variant:i.locked_zone===null?"default":"outline",size:"sm",onClick:()=>h("locked_zone",null),children:"None"})]})]})]}),e.jsxs("div",{className:"pt-3 border-t border-slate-100",children:[e.jsxs(d,{className:"text-sm font-semibold text-slate-700 flex items-center gap-2 mb-3",children:[e.jsx(Ve,{className:"w-4 h-4"})," Cycle Logic"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Enable Cycle"}),e.jsx(F,{checked:i.cycle_enabled??!0,onCheckedChange:s=>h("cycle_enabled",s)})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-xs text-slate-500",children:"Duration (ms)"}),e.jsx($,{type:"number",value:i.cycle_duration??6e3,onChange:s=>h("cycle_duration",parseInt(s.target.value)||6e3),className:"mt-1"})]})]})]}),e.jsxs("div",{className:"pt-3 border-t border-slate-100",children:[e.jsxs(d,{className:"text-sm font-semibold text-slate-700 flex items-center gap-2 mb-2",children:[e.jsx(We,{className:"w-4 h-4"})," Restricted (",i.restricted_designs.length,")"]}),e.jsx("p",{className:"text-xs text-slate-400",children:i.restricted_designs.length>0?i.restricted_designs.join(", "):"None - manage in Collections →"})]})]})]}),e.jsxs(C,{className:"rounded-2xl border-slate-100 shadow-lg lg:col-span-2",children:[e.jsx(w,{className:"pb-4 border-b border-slate-100",children:e.jsxs(k,{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-purple-500"}),"Collections Manager"]})}),e.jsxs(y,{className:"pt-4",children:[e.jsxs(Oe,{value:j,onValueChange:s=>W(s),children:[e.jsxs($e,{className:"mb-4",children:[e.jsx(L,{value:"Street",children:"Street"}),e.jsx(L,{value:"Vintage",children:"Vintage"}),e.jsx(L,{value:"Logo",children:"Logo"})]}),["Street","Vintage","Logo"].map(s=>e.jsx(Fe,{value:s,className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:V[s].map(t=>{const a=P(t.filename),o=B(t.filename),n=r===t.filename;return e.jsxs("div",{onClick:()=>z(n?null:t.filename),className:`relative rounded-xl overflow-hidden border-2 cursor-pointer transition-all ${n?"border-blue-500 ring-2 ring-blue-200":a?"border-red-300 opacity-60":"border-slate-200 hover:border-slate-400"}`,children:[e.jsx("div",{className:"aspect-square flex items-center justify-center p-2",style:{backgroundColor:D},children:e.jsx("img",{src:t.url,alt:t.filename,className:"max-w-full max-h-full object-contain"})}),e.jsxs("div",{className:"absolute top-1 right-1 flex gap-1",children:[a&&e.jsx("span",{className:"bg-red-500 text-white text-[9px] px-1.5 py-0.5 rounded-full font-bold",children:"BLOCKED"}),o&&e.jsx("span",{className:"bg-purple-500 text-white text-[9px] px-1.5 py-0.5 rounded-full font-bold",children:"ALT"})]}),e.jsx("div",{className:"bg-white/90 backdrop-blur-sm px-2 py-1 text-[10px] font-mono text-slate-600 truncate",children:t.filename})]},t.filename)})})},s))]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100 flex items-center gap-3",children:[e.jsx(d,{className:"text-sm font-semibold text-slate-700",children:"Preview Color:"}),e.jsx("div",{className:"flex gap-1",children:u.map(s=>e.jsx("button",{onClick:()=>J(s.hex),className:`w-6 h-6 rounded-full border transition-all ${D===s.hex?"ring-2 ring-blue-400 border-blue-500":"border-slate-300"}`,style:{backgroundColor:s.hex},title:s.name},s.hex))})]})]})]})]}),r&&e.jsxs(C,{className:"rounded-2xl border-blue-200 shadow-lg bg-blue-50/30",children:[e.jsxs(w,{className:"pb-4 border-b border-blue-100 flex flex-row items-center justify-between",children:[e.jsxs(k,{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-blue-500"}),r]}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>z(null),children:e.jsx(S,{className:"w-4 h-4"})})]}),e.jsx(y,{className:"pt-4",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-semibold text-slate-700 mb-2 block",children:"Live Preview"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:u.filter(s=>i.allowed_colors.includes(s.hex)).map(s=>{var n;const a=se(r).includes(s.hex),o=(n=ee.find(te=>te.filename===r))==null?void 0:n.url;return e.jsx("div",{onClick:()=>Z(r,s.hex),className:`aspect-square rounded-lg overflow-hidden cursor-pointer border-2 transition-all ${a?"border-green-500 ring-1 ring-green-300":"border-red-300 opacity-50"}`,style:{backgroundColor:s.hex},title:`Click to ${a?"disable":"enable"} ${s.name}`,children:e.jsxs("div",{className:"w-full h-full flex items-center justify-center p-2 relative",children:[o&&e.jsx("img",{src:o,alt:"",className:"max-w-full max-h-full object-contain"}),e.jsx("div",{className:"absolute top-1 right-1",children:a?e.jsx(qe,{className:"w-4 h-4 text-green-600 bg-white rounded-full p-0.5"}):e.jsx(S,{className:"w-4 h-4 text-red-600 bg-white rounded-full p-0.5"})})]})},s.hex)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-slate-200",children:[e.jsxs("div",{children:[e.jsxs(d,{className:"font-semibold text-slate-700",children:["Restrict for ",A[g]]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Hide this design from this product"})]}),e.jsx(F,{checked:P(r),onCheckedChange:()=>X(r)})]}),e.jsxs("div",{className:"p-3 bg-white rounded-lg border border-slate-200",children:[e.jsxs(d,{className:"font-semibold text-slate-700 flex items-center gap-2 mb-2",children:[e.jsx(Be,{className:"w-4 h-4 text-purple-500"})," Alternative Design"]}),(()=>{const s=B(r);return s?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-xs text-slate-500",children:"Trigger Colors (click to toggle)"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:u.map(t=>{const a=s.trigger_colors.includes(t.hex);return e.jsx("button",{onClick:()=>Q(r,t.hex),className:`w-6 h-6 rounded-full border-2 transition-all ${a?"border-purple-500 ring-2 ring-purple-200":"border-slate-300 opacity-50"}`,style:{backgroundColor:t.hex},title:t.name},t.hex)})})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-xs text-slate-500",children:"Replace With (filename)"}),e.jsx($,{value:s.replace_with,onChange:t=>E(r,"replace_with",t.target.value),placeholder:"e.g. street-3-alt.png",className:"mt-1"})]}),e.jsxs(c,{variant:"destructive",size:"sm",onClick:()=>H(r),children:[e.jsx(S,{className:"w-4 h-4 mr-1"})," Remove Rule"]})]}):e.jsxs(c,{variant:"outline",size:"sm",onClick:Y,children:[e.jsx(Ue,{className:"w-4 h-4 mr-1"})," Add Alternative Rule"]})})()]})]})]})})]})]})};export{rs as default};
